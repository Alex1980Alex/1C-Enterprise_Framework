# API Key Authentication Guide
# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API –∫–ª—é—á–∏

**–î–∞—Ç–∞**: 2025-11-03
**–í–µ—Ä—Å–∏—è**: 1.0
**–°—Ç–∞—Ç—É—Å**: ‚úÖ READY

---

## –û–±–∑–æ—Ä

BSL Code Search API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é** –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ API –∫–ª—é—á–∏.

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

1. **–ë–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
   - –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `API_KEY` –∏–ª–∏ `API_KEYS` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
   - API –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
   - –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

2. **–° –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π**:
   - –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `API_KEY` –∏–ª–∏ `API_KEYS`
   - –¢—Ä–µ–±—É–µ—Ç—Å—è API –∫–ª—é—á –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-–¥–µ–ø–ª–æ—è

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è API –∫–ª—é—á–∞

```bash
cd ai-memory-system
python scripts/generate_api_key.py
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞**:
```
================================================================================
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ 1 API –∫–ª—é—á(–µ–π)
================================================================================

[1] xJk2vN-9mP3qW8rT5yU7eH4bG6nL1dS0fA_cVxZ

================================================================================
–î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á–∏ –≤ .env —Ñ–∞–π–ª:
================================================================================

API_KEY=xJk2vN-9mP3qW8rT5yU7eH4bG6nL1dS0fA_cVxZ
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

**–í–∞—Ä–∏–∞–Ω—Ç A: –û–¥–∏–Ω –∫–ª—é—á**
```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å .env.example
cp .env.example .env

# –î–æ–±–∞–≤–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á
API_KEY=xJk2vN-9mP3qW8rT5yU7eH4bG6nL1dS0fA_cVxZ
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–π (–¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤)**
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 3 –∫–ª—é—á–µ–π
python scripts/generate_api_key.py --count 3

# –î–æ–±–∞–≤–∏—Ç—å –≤ .env
API_KEYS=key1,key2,key3
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞

```bash
cd ai-memory-system
python -m uvicorn api.main:app --host 0.0.0.0 --port 8000 --reload
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**:
```
INFO:     üîí –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: –í–ö–õ–Æ–ß–ï–ù–ê (—Ç—Ä–µ–±—É–µ—Ç—Å—è API key)
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Web UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/
2. –í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –≤ –ø–æ–ª–µ "üîë API Key"
3. –ö–ª—é—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage –±—Ä–∞—É–∑–µ—Ä–∞
4. –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –ø–æ–∏—Å–∫ –∫–∞–∫ –æ–±—ã—á–Ω–æ

### cURL (POST)

```bash
curl -X POST "http://localhost:8000/api/v1/search" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY_HERE" \
  -d '{
    "query": "—Ä–∞–±–æ—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏",
    "top_k": 5,
    "score_threshold": 0.3
  }'
```

### cURL (GET)

```bash
curl -H "Authorization: Bearer YOUR_API_KEY_HERE" \
  "http://localhost:8000/api/v1/search?query=–æ–±—Ä–∞–±–æ—Ç–∫–∞+–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤&top_k=5"
```

### Python

```python
import requests

API_KEY = "YOUR_API_KEY_HERE"

headers = {
    "Authorization": f"Bearer {API_KEY}"
}

response = requests.post(
    "http://localhost:8000/api/v1/search",
    headers=headers,
    json={
        "query": "—Ä–∞–±–æ—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏",
        "top_k": 5,
        "score_threshold": 0.3
    }
)

results = response.json()
print(results)
```

### JavaScript/Fetch

```javascript
const API_KEY = "YOUR_API_KEY_HERE";

fetch('http://localhost:8000/api/v1/search', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${API_KEY}`
    },
    body: JSON.stringify({
        query: '—Ä–∞–±–æ—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏',
        top_k: 5,
        score_threshold: 0.3
    })
})
.then(response => response.json())
.then(data => console.log(data));
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 1 –∫–ª—é—á–∞
python scripts/generate_api_key.py

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 3 –∫–ª—é—á–µ–π
python scripts/generate_api_key.py --count 3

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ .env –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
python scripts/generate_api_key.py --count 3 --save

# –í—ã–≤–æ–¥ –≤ ENV —Ñ–æ—Ä–º–∞—Ç–µ (–¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è)
python scripts/generate_api_key.py --format env

# –í—ã–≤–æ–¥ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
python scripts/generate_api_key.py --format json
```

### –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π

1. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á:
   ```bash
   python scripts/generate_api_key.py
   ```

2. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á –≤ —Å–ø–∏—Å–æ–∫ (–æ—Å—Ç–∞–≤–∏–≤ —Å—Ç–∞—Ä—ã–π):
   ```bash
   # .env
   API_KEYS=old_key,new_key
   ```

3. –û–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –Ω–æ–≤—ã–π –∫–ª—é—á

4. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–ª—é—á –∏–∑ —Å–ø–∏—Å–∫–∞

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```bash
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –∏–∑ .env
# API_KEY=...
# API_KEYS=...
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –±—É–¥–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–∞.

---

## –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 401 Unauthorized

**–ü—Ä–∏—á–∏–Ω–∞**: API key –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –î–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization
curl -H "Authorization: Bearer YOUR_KEY" ...
```

### 403 Forbidden

**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π API key

**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –∞–∫—Ç–∏–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è en –≤ .env
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env

### Health Check –¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**OK**: Endpoints `/health` –∏ `/api/v1/stats` –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ API key

---

## Production —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

```bash
# .env
API_KEYS=prod_key_1,prod_key_2,prod_key_3
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS

```nginx
server {
    listen 443 ssl;
    server_name api.yourdomain.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 3. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ CORS

```python
# api/main.py
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://yourdomain.com"],  # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã
    allow_credentials=True,
    allow_methods=["GET", "POST"],
    allow_headers=["Authorization", "Content-Type"],
)
```

### 4. Rate Limiting

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å rate limiting —á–µ—Ä–µ–∑ nginx –∏–ª–∏ slowapi:

```bash
pip install slowapi
```

```python
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)
app.state.limiter = limiter
app.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)

@app.post("/api/v1/search")
@limiter.limit("10/minute")
async def search_code(request: Request, ...):
    ...
```

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏—Ä—É–π—Ç–µ –ø–æ–ø—ã—Ç–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
- –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ (401, 403)
- –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ API –∫–ª—é—á–∏ (–ø–µ—Ä–≤—ã–µ 8 —Å–∏–º–≤–æ–ª–æ–≤)

---

## FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API –±–µ–∑ –∫–ª—é—á–∞?**
A: –î–∞, –µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `API_KEY`/`API_KEYS` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, API —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

**Q: –ö–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á–∏?**
A: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .env —Ñ–∞–π–ª, –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –µ–≥–æ –≤ git (–¥–æ–±–∞–≤–ª–µ–Ω –≤ .gitignore), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ production.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤?**
A: –î–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `API_KEYS=key1,key2,key3` –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª—é—á–µ–π.

**Q: –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞ –∫–ª—é—á–µ–π?**
A: –î–æ–±–∞–≤—å—Ç–µ rate limiting –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

**Q: –ù—É–∂–Ω–∞ –ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏?**
A: –ù–µ—Ç, –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. **Caching** - –¥–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **Advanced filters** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
3. **History** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–æ–≤
4. **Export** - —ç–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ CSV/JSON

---

**–ê–≤—Ç–æ—Ä**: Claude Code AI
**–î–∞—Ç–∞**: 2025-11-03
**–ü—Ä–æ–µ–∫—Ç**: 1C-Enterprise_Framework / ai-memory-system
