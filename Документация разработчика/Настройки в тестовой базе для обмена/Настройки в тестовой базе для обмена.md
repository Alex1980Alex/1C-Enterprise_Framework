Это настройки в тестовой базе для обменаПосле того, как заливают новые архивы из нужно перенастраивать
https://confluence.sodru.com/pages/viewpage.action?pageId=79566462 - полезная ссылка по доступу
https://confluence.sodru.com/pages/viewpage.action?pageId=47974116 - подключение реббита
Очереди:rus-dev1c01_TEST_tm_svetly - для отправки сообщения.ys-appdev1c01_DEV_MFM_01. - в Спр. получатель
После заливки базы нужно будет восстановить обмен в тестовой МФМ и обновить разработками

## Чек-лист подключение объекта к подсистеме Управление доступом.

Все объекты метаданных, для которых описана логика ограничения, необходимо указать в процедуре
гкс_УправлениеДоступом.ПриЗаполненииСписковСОграничениемДоступа 
и
гкс_УправлениеДоступом.ПриЗаполненииВидовОграниченийПравОбъектовМетаданных
Для выбранных объектов метаданных необходимо вставить в модуль формы объекта
в процедуру обработчика события ПриЧтенииНаСервере вызов: УправлениеДоступом.ПриЧтенииНаСервере(ЭтотОбъект, ТекущийОбъект);
в процедуру обработчика события ПослеЗаписиНаСервере вызов: УправлениеДоступом.ПослеЗаписиНаСервере(ЭтотОбъект, ТекущийОбъект, ПараметрыЗаписи);
 Прописать ограничения для объекта в права ролей. Примеры с текстом шаблонов ограничений скопировать из роли ИзменениеУчастниковГруппДоступа
Примеры текста ограничений на Чтение для вида доступа Организации
Для справочников:
#Если &ОграничениеДоступаНаУровнеЗаписейУниверсально #Тогда
#ДляОбъекта("")
#Иначе
#ПоЗначениям( "Справочник.<ИмяСправочника>","Чтение","",
"Организации","<ИмяРеквизитаСодержащегоДанныеПоОрганизации>","","","","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","" )
#КонецЕсли

Для документов:#Если &ОграничениеДоступаНаУровнеЗаписейУниверсально #Тогда
#ДляОбъекта("")
#Иначе
#ПоЗначениям( "Справочник.<ИмяДокумента>","Чтение","",
"Организации","<ИмяРеквизитаСодержащегоДанныеПоОрганизации>","","","","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","" )
#КонецЕсли

Для регистра накопления:
#Если &ОграничениеДоступаНаУровнеЗаписейУниверсально #Тогда
#ДляРегистра("ИдентификаторыОбъектовМетаданных.РегистрНакопления<ИмяРегистра>", "<ИмяПоляСодержащегоДанныеПоОрганизации>", "", "", "", "")
#Иначе
#ПоЗначениям( "РегистрНакопления.<ИмяРегистра>","Чтение","",
"Организации","<ИмяПоляСодержащегоДанныеПоОрганизации>",
"","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","" )
#КонецЕсли

Для регистра сведений:
#Если &ОграничениеДоступаНаУровнеЗаписейУниверсально #Тогда
#ДляРегистра("ИдентификаторыОбъектовМетаданных.РегистрСведений<ИмяРегистра>", "<ИмяПоляСодержащегоДанныеПоОрганизации>", "", "", "", "")
#Иначе
#ПоЗначениям( "РегистрСведений.<ИмяРегистра>","Чтение","",
"Организации","<ИмяПоляСодержащегоДанныеПоОрганизации>",
"","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","", "","" )
#КонецЕсли

Если данные по организации являются реквизитом одного из полей, для стандартного варианта ограничений необходимо использовать шаблон ПоЗначениямРасширенный.
Например для РН.гкс_МатериальныйПоток Организация свляется реквизитом измерения АналитикаРазмещения, тогда ограничение на чтение выглядит так:

#Если &ОграничениеДоступаНаУровнеЗаписейУниверсально #Тогда
#ДляРегистра("ИдентификаторыОбъектовМетаданных.РегистрНакоплениягкс_МатериальныйПоток", "АналитикаРазмещения", "", "", "", "")
#Иначе
#ПоЗначениямРасширенный( "РегистрНакопления.гкс_МатериальныйПоток", "Чтение", "",
"ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.гкс_АналитикаРазмещения КАК Т1
ПО Т.АналитикаРазмещения = Т1.КлючАналитики",
"",
"Организации","Т1.Организация",
"", "", "", "", "","","", "","","", "","","", "","","", "","","", "","","", "","","", "","","", "","","", "","","", "","","", "","","", "","","", "","","" )
#КонецЕсли
Имена регистров с ограничениями доступа необходимо указать в качестве предопределенных элементов справочника ИдентификатораОбъектовМетаданных как полное имя метаданных без точки-разграничителя:
РегистрНакоплениягкс_МатериальныйПоток
В модуль менеджера объекта вставить процедуру ПриЗаполненииОграниченияДоступа, описывающую логику ограничений доступа
#Область ДляВызоваИзДругихПодсистем

Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт

Ограничение.Текст =
"РазрешитьЧтениеИзменение
|ГДЕ
| ЗначениеРазрешено(Организация)";

КонецПроцедуры

#КонецОбласти


Для РН.гкс_МатериальныйПоток текст процедуры будет выглядеть так:
Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт

Ограничение.Текст =
"РазрешитьЧтениеИзменение
|ГДЕ
| ЗначениеРазрешено(АналитикаРазмещения .Организация)";

КонецПроцедуры

Включить объект в определяемые типы
ВладелецЗначенийКлючейДоступа - Все ссылочные объекты с ограничением доступа
ВладелецЗначенийКлючейДоступаОбъект - Все ссылочные объекты (кроме документов) из определяемого типа ВладелецЗначенийКлючейДоступа
ВладелецЗначенийКлючейДоступаДокумент - Все документы из определяемого типаВладелецЗначенийКлючейДоступа
ВладелецЗначенийКлючейДоступаНаборЗаписей - Все регистры с ограничением (кроме регистров расчета)
ПолеРегистраКлючейДоступаКРегистрам - Все типы собственных полей регистра, указанных в ограничении доступа к ним (типы опорных полей - аналог ссылки у объекта). Например для РС.ДанныеТранспортногоДокумента это тип Документ.гкс-ТранспортныйДокумент
Подробное описание подключения объектов к подсистеме см на ИТС. Настройка подключения объектов к подсистеме Управление доступом

После добавления объекта с использованием РЛС необходимо проверить правильность встраивания объекта в подсистему "Управление доступом" с помощью отчета ПроверкаВнедренияБСП.erf (отчет включен в поставку БСП). Подробнее см. на ИТС



## ИАС. Инструкции. Настройка тестовой среды

Для тестирования интеграций через интеграционный адаптер необходимо настроить обмен через тестовую установку RMQ.

Для тестирования необходимо наличие в RMQ тестовой очереди.

Тестовая очередь именуется строкой подключения базы получателя сообщений, например для базы получателя Srvr="AS-1CDEV01";Ref="DEV_BAV_03"; имя очереди и ключ маршрутизации будет AS-1CDEV01_DEV_BAV03.

Для создания очереди обращаться к:

Макаревич Дмитрий Игоревич (Unlicensed)

 Артем Башмаков (Deactivated)

 Серверы очередей RMQ - необходимо оставить один элемент в справочнике, остальные пометить на удаления, а лучше очистить поля с именем сервера, пользователем и паролем, для гарантии, что данные не отправятся в рабочие очереди.

Адрес сервера - ms-s-rabbitmq01.sodrugestvo.local

Виртуальный хост - /develop

Порт - 5672

Логин - develop

Пароль - develop

Состояния сообщений - не изменяются, т.к. это не настройка, как и Проблемы обмена данными.

Прочее - необходимо указать текущую строку соединения ИБ

Подписки на события - необходимо выключить активность у всех элементов. Для тестовой базы-получателя указать имя очереди для получения сообщений из тестовой очереди, при указании расписания создается регламентное задание и соответствующим наименованием, в рамках которого загружаются сообщения из очереди. Включить активность. Обработка сообщений выполняется после загрузки, или вручную из список входящих сообщений

Входящие сообщения - не настройка

Очередь входящих сообщений - не настройка

Исходящие сообщения - не настройка

Задания на отправку - для создания регламентного задания в базе отправителе для отправки сообщений (можно также отправлять вручную из списка исходящих сообщений). Создается регламентное задание с указанным наименованием.

Получатели данных - необходимо оставить активным только нужных элемент и настроить его на соответствующую точку обмена и ключи маршрутизации. Ключ маршрутизации здесь обычно совпадается с именем очереди, в которую нужно отправить данные.