Приложение 1. Формат файла сообщения обмена данными
Данный документ описывает формат файла сообщения обмена данными, который используется подсистемой «Обмен данными» конфигурации «Библиотека стандартных подсистем, редакция. 1.2». Версия формата: 3.2.
С помощью сообщений обмена выполняется обмен данными между информационными базами различных конфигураций, а также со сторонними базами данных. Возможна передача данных как ссылочных типов, так и наборов записей регистров. Помимо самих данных, сообщение обмена содержит в себе также правила для загрузки этих данных.
Сообщение обмена представляет из себя xml-файл в кодировке UTF-8.
Термины
Сообщение обмена – xml-файл, в котором содержатся структурированные в соответствии с форматом данные, выгруженные из информационной базы-источника для загрузки в базу-приемник. База-источник – информационная база данных, которая служит источником для выгрузки данных в сообщение обмена. База-приемник – информационная база данных, в которую выполняется загрузка данных сообщения обмена. Узел-отправитель – предопределенный элемент плана обмена базы-источника, от имени которого выполняется формирование сообщения обмена. Узел-получатель – элемент плана обмена базы-приемника, для которого предназначено сообщение обмена. Интерактивная загрузка – процесс загрузки данных с использованием сервиса интерактивной загрузки подсистемы «Обмен данными». При интерактивной загрузке данных можно выполнять предварительный просмотр загружаемых данных и выполнять сопоставление объектов информационных баз. Коллизия изменений – событие, которое возникает при загрузке данных, заключающееся в том, что один и тот же объект изменен в базе-источнике и базе-приемнике. Для автоматического решения коллизий изменений в правилах обмена настраиваются приоритеты объектов при загрузке. Фильтр ограничения миграции данных – вспомогательный сервис подсистемы «Обмен данными», который позволяет настраивать ограничения миграции данных между парами обменивающихся конфигураций. Информация сопоставления объектов – информация сопоставления объектов базы-источника объектам базы-приемника. Эта информация используется для задания соответствия одного и того же с прикладной точки зрения объекта, разным
использовать, то это приведет к появлению дублей объектов в обменивающихся базах. Обработчик события – произвольный текст на встроенном языке «1С:Предприятия», который выполняется в процессе обмена данными. Подробнее об обработчиках событий см. справку к конфигурации «Конвертация данных», меню Справка – Информация об обработчиках.
Аббревиатуры
ПКО – правило конвертации объектов, ПКС – правило конвертации свойств объекта, ПКЗ – правило конвертации значений объекта, ПКГС – правило конвертации группы свойств.
Примечание
Подробнее см. справку к конфигурации «Конвертация данных», меню Справка – Быстрое освоение.
Типы данных
Для чтения значений, которые хранятся в файле сообщения обмена, используется метод глобального контекста платформы «1С:Предприятие» XMLЗначение() , для записи – применяется XMLСтрока() . Представление значения в файле определяется типом самого значения:
Строка – представляется в виде строки. Булево – значение Истина имеет представление "true", а значение Ложь – "false" Дата – в виде представления типа dateTime схемы XML. Число – в виде представления типа decimal схемы XML. Значение системного перечисления – хранится строковое представление имени
значения перечисления. УникальныйИдентификатор – хранится строковое представление уникального
идентификатор. Ссылки – в виде строкового представления уникального идентификатора. ХранилищеЗначения и ДвоичныеДанные – в виде строки в формате base64.
Значения по умолчанию
Если атрибут узла является необязательным, то его можно не указывать. В случае, если атрибут узла не указан, то используется его значение по умолчанию. Значение по умолчанию зависит от типа значения атрибута, если не указано иное:
Строка – пустая строка, Булево – Ложь ,
Заголовок файла
Заголовок файла сообщения обмена должен содержать описание кодировки файла в формате UTF-8:
<?xml version="1.0" encoding="UTF-8"?>
Далее приводится описание узлов файла сообщения обмена:
# Приложение 1. Формат файла сообщения обмена данными Термины Аббревиатуры Типы данных Значения по умолчанию Заголовок файла ФайлОбмена
ДанныеПоОбмену Объект
Ссылка Свойство Значение Нпп Выражение Пусто ЗначениеПараметра (Для объекта) ТабличнаяЧасть Запись
СубконтоДт СубконтоКт
НаборЗаписей НаборЗаписейРегистра
Отбор СтрокиНабораЗаписей
УдалениеОбъекта ИнформацияОРегистрацииОбъекта КорректировкаИнформацииОРегистрацииОбъекта ЗначениеПараметра АлгоритмПослеЗагрузкиПараметров ПравилаОбмена
ПравилаКонвертацииОбъектов Правило Параметры
Параметр Алгоритмы
Запросы Запрос
Текст
ФайлОбмена
Узел ФайлОбмена (обязательный). Использование: однократно.
Описание:
Корневой узел сообщения обмена. Сообщение обмена должно начинаться с этого узла. Содержит дочерние узлы, которые условно подразделяются на узлы заголовка сообщения, узлы данных сопоставления и узлы с данными сообщения.
Узлы заголовка сообщения содержат вспомогательную информацию о данных сообщения и включаются однократно в файл. Узлы с данными сопоставления содержат данные о сопоставлении объектов и включаются многократно в файл. Узлы с данными сообщения содержат сами данные и включаются многократно в файл.
Последовательность расположения дочерних узлов регламентирована:
1. Заголовок (обязательный), 2. Данные сопоставления (необязательный), 3. Данные (необязательный).
Последовательность узлов заголовка регламентировано:
1. ПравилаОбмена , 2. ДанныеПоОбмену , 3. Алгоритм , 4. ЗначениеПараметра , 5. АлгоритмПослеЗагрузкиПараметров .
Атрибуты:
ВерсияФормата (обязательный) – Строка . Версия формата сообщения обмена. ДатаВыгрузки (необязательный) – Дата . Дата формирования сообщения обмена. ИмяКонфигурацииИсточника (необязательный) – Строка . Наименование конфигурации
базы-источника. ИмяКонфигурацииПриемника (необязательный) – Строка . Наименование конфигурации
базы-приемника. ИдПравилКонвертации (необязательный) – УникальныйИдентификатор . Уникальный
идентификатор правил конвертации в конфигурации «Конвертация данных». Используется при обновлении правил обмена. Комментарий (необязательный) – Строка . Произвольный комментарий к
выгружаемым данным.
Формат:
 
<?xml version="1.0" encoding="UTF-8"?>
<ФайлОбмена>
{ ЗАГОЛОВОК
<ПравилаОбмена>…</ПравилаОбмена>
<ДанныеПоОбмену>…</ДанныеПоОбмену>
<ЗначениеПараметра>…</ЗначениеПараметра>
<АлгоритмПослеЗагрузкиПараметров>…</АлгоритмПослеЗагрузкиПараметров>
ЗАГОЛОВОК }
{ДАННЫЕ СОПОСТАВЛЕНИЯ
<ИнформацияОРегистрацииОбъекта>…</ИнформацияОРегистрацииОбъекта>
[<КорректировкаИнформацииОРегистрацииОбъекта>…</ КорректировкаИнформацииОРегистрацииОбъекта> ] (#корректировкаинформацииорегистрацииобъекта)
ДАННЫЕ СОПОСТАВЛЕНИЯ}
{ДАННЫЕ
<Объект>…</Объект>
<НаборЗаписейРегистра>…</НаборЗаписейРегистра>
<УдалениеОбъекта>…</УдалениеОбъекта>
ДАННЫЕ }
</ФайлОбмена>
Пример:
<?xml version="1.0" encoding="UTF-8"?> <ФайлОбмена ВерсияФормата="3.0" ДатаВыгрузки="2010-07-30T17:09:02" ИмяКонфигурацииИсточни </ФайлОбмена>
ДанныеПоОбмену
Узел ДанныеПоОбмену (обязательный). Использование: однократно.
Описание:
Содержит информацию о плане обмена для загрузки данных и информацию механизма
 
ПланОбмена (обязательный) – Строка . Имя плана обмена, как объекта метаданных конфигурации, для которого предназначено сообщение обмена. Кому (обязательный) – Строка . Код узла плана обмена базы-приемника, для
которого предназначено сообщение. ОтКого (обязательный) – Строка . Код предопределенного узла плана обмена базы-
источника, от имени которого отправлено сообщение. НомерИсходящегоСообщения (обязательный) – Число . Номер исходящего сообщения
узла-отправителя. НомерВходящегоСообщения (обязательный) – Число . Номер последнего успешно-
принятого сообщения от узла-получателя в узле-отправителе. УдалитьРегистрациюИзменений (обязательный) – Булево . Признак необходимости
удаления регистрации изменений на узле-получателе при получении сообщения.
Формат:
не содержит дочерних узлов.
Пример:
<ДанныеПоОбмену ПланОбмена="ОбменУправлениеТорговлейБухгалтерияПредприятия" Кому="001" От
Объект
Узел Объект (необязательный). Использование: многократно.
Описание:
Узел содержит один объект загрузки. В качестве объекта загрузки может выступать любой объект ссылочного типа: документ, элемент справочника и пр. Узел содержит дочерние узлы, в которых содержатся значения свойств, значения параметров, табличные части и таблицы движений (для документов) объекта загрузки.
Узел формируется на основании правил описанных в ПКО.
Атрибуты:
Тип (обязательный) – Строка . Строковое представление типа объекта. Используется для получения типа объекта функцией Тип() . ИмяПравила (обязательный) – Строка . Имя правила конвертации объекта.
Используется для идентификации загружаемого объекта с правилом конвертации (см. узел Код для узла Правило). Нпп (необязательный) – Число . Номер выгружаемого объекта в файле в порядке
выгрузки. Используется при отладке процесса обмена и для кэширования выгружаемых данных. Пример использования атрибута для кэширования выгружаемых данных приведен в разделе описания узла Нпп. Источник (необязательный) – Строка . Произвольное описание объекта для вывода в
случае возникновения коллизии изменений. Возможные значения: "Выше", "Ниже", "Совпадает". Значение по умолчанию – "Выше". Соответствует значению параметра ПКО "Приоритет объекта загрузки". РежимЗаписи (необязательный) – Строка . Режим записи документа. Актуален только
для типа объекта Документ . Возможные значения: "Запись" (документ будет записан), "Проведение" (документ будет записан в режиме проведения), "ОтменаПроведения" (документ будет записан в режиме отмены проведения). Значение по умолчанию – "Запись". Соответствует значению параметра РежимЗаписи обработчика события ПКО "Перед выгрузкой". РежимПроведения (необязательный) – Строка . Режим проведения документа.
Актуален только для типа объекта Документ . Возможные значения: "Неоперативный", "Оперативный". Значение по умолчанию – "Неоперативный". Соответствует значению параметра РежимПроведения обработчика события ПКО "Перед выгрузкой".
Формат:
<Объект>
[<Ссылка>…</Ссылка> ](#ссылка)
<Свойство>…</Свойство>
<ЗначениеПараметра>…</ЗначениеПараметра>
<ТабличнаяЧасть>…</ТабличнаяЧасть>
[<НаборЗаписей>…</НаборЗаписей> ](#наборЗаписей)
</Объект>
Пример:
<Объект Нпп="24" Тип="СправочникСсылка.Номенклатура" ИмяПравила="Номенклатура"> <Ссылка> <Свойство Имя="{УникальныйИдентификатор}" Тип="Строка" ТипИсточника="СправочникСсылка.Номенклатура" ТипПриемника="СправочникСсылка.Номенклатура"> <Значение>bd72d927-55bc-11d9-848a-00112f43529a</Значение> </Свойство> <Свойство Имя="ЭтоГруппа" Тип="Булево"> <Значение>false</Значение> </Свойство> </Ссылка> <Свойство Имя="Код" Тип="Строка"> <Значение>00000000057</Значение> </Свойство> <Свойство Имя="Наименование" Тип="Строка"> <Значение>Комбайн кухонный BINATONE FP 67</Значение> </Свойство> <Свойство Имя="Родитель" Тип="СправочникСсылка.Номенклатура"> <Ссылка> <Свойство Имя="{УникальныйИдентификатор}" Тип="Строка" ТипИсточника="СправочникСсылка.Номенклатура" ТипПриемника="СправочникСсылка.Номенклатура"> <Значение>bd72d925-55bc-11d9-848a-00112f43529a</Значение> </Свойство> <Свойство Имя="ЭтоГруппа" Тип="Булево"> <Значение>true</Значение> </Свойство> </Ссылка> </Свойство> <Свойство Имя="НаименованиеПолное" Тип="Строка"> <Значение>Комбайн кухонный BINATONE FP 67</Значение> </Свойство> <Свойство Имя="СтавкаНДС" Тип="ПеречислениеСсылка.СтавкиНДС"> <Значение>НДС18</Значение> </Свойство> <Свойство Имя="Услуга" Тип="Булево"> <Значение>false</Значение> </Свойство> </Объект>
Ссылка
Узел Ссылка (необязательный). Использование: однократно; в самом начале родительского узла Объект .
Описание:
Содержит значения свойств и параметров для идентификации (поиска) объекта загрузки в базе-приемнике. Узел может содержать служебные свойства.
узле Ссылка.
Свойства, расположенные в этом узле принято называть свойствами поиска.
Атрибуты:
Нпп (необязательный) – Число . Номер выгружаемой ссылки (объекта) в файле в порядке выгрузки. Используется при отладке процесса обмена и для кэширования выгружаемых данных. Пример использования атрибута для кэширования выгружаемых данных приведен в разделе описания узла Нпп. РегистрироватьОбъектНаУзлеОтправителе (необязательный) – Булево . Признак того, что
объект необходимо зарегистрировать к выгрузке для узла-отправителя (отправка объекта назад). Соответствует значению параметра РегистрироватьОбъектНаУзлеОтправителе обработчика события ПКО "Перед выгрузкой". НеСоздаватьЕслиНеНайден (необязательный) – Булево . Отказ от создания нового
объекта. Используется если необходимо выполнять только обновление существующих объектов. Истина – будет обновлен только существующий объект в базе-приемнике. Соответствует значению параметра ПКО "Не создавать новый объект в приемнике, если он НЕ найден". ПриоритетОбъектаОбмена (необязательный) – Строка . Приоритет загружаемого
объекта в случае возникновения коллизии изменений. Возможные значения: "Выше", "Ниже", "Совпадает". Значение по умолчанию – "Выше". Соответствует значению параметра ПКО "Приоритет объекта загрузки". ПродолжитьПоиск (необязательный) – Булево . Определяет режим поиска объекта в
случае, если по уникальному идентификатору ссылки объект не был найден. Истина
– поиск объекта будет продолжен по полям поиска и по алгоритму поиска (если задан); Ложь – дополнительный поиск не выполняется. Атрибут используется только, если поиск объекта в базе-приемнике выполняется по уникальному идентификатору ссылки, т. е. в узле присутствует свойство {УникальныйИдентификатор} . Рекомендуется использовать только для справочников-
классификаторов.
Формат:
<Ссылка>
<Свойство>…</Свойство>
<ЗначениеПараметра>…</ЗначениеПараметра>
</Ссылка>
Пример:
<Ссылка> <Свойство Имя="{УникальныйИдентификатор}" Тип="Строка" ТипИсточника="СправочникСсылка.Номенклатура" ТипПриемника="СправочникСсылка.Номенклатура"> <Значение>bd72d927-55bc-11d9-848a-00112f43529a</Значение> </Свойство> <Свойство Имя="ЭтоГруппа" Тип="Булево"> <Значение>false</Значение> </Свойство> </Ссылка>
Свойство
Узел Свойство (необязательный). Использование: многократно.
Описание:
Содержит значение свойства объекта загрузки. В качестве значения свойства может быть значение примитивного типа; дочерний узел Ссылка, если свойство имеет ссылочный тип; порядковый номер ссылки ( Нпп ) в файле сообщения обмена, если ссылка была выгружена ранее; произвольное выражение; пустое значение.
Узел формируется на основании правил описанных в ПКС.
Узлы Свойства бывают трех типов:
свойства объекта свойства субконто служебные свойства
Свойства объекта предназначены для передачи данных непосредственно в свойства объекта в базе-приемнике. В таком случае, атрибут Имя совпадает с именем свойства объекта в базе-приемнике (так как оно задано в Конфигураторе).
Свойства субконто предназначены для передачи значений субконто Дт и субконто Кт в движениях документов. Атрибут Имя принимает только два значения:
атрибут Имя = Ключ атрибут Имя = Значение
Свойства субконто используются только для узла Запись.
Служебные свойства предназначены для идентификации ссылочного объекта в базе-приемнике при его загрузке. Имена служебных свойств заключаются в фигурные скобки "{" и "}".
Предусмотрены следующие имена служебных свойств:
атрибут Имя = {УникальныйИдентификатор} атрибут Имя = {ИмяПредопределенногоЭлемента}
Служебные свойства могут быть использованы только для узла Ссылка
Примечание
Для элементов иерархических справочников свойство с именем ЭтоГруппа должно находиться в узле Ссылка.
Атрибуты:
Имя (обязательный) – Строка . Имя свойства объекта в базе-получателе, как оно задано в конфигураторе. Для свойств субконто атрибут может принимать только два значения "Ключ" и "Значение". Тип (обязательный) – Строка . Строковое представление типа свойства. ИмяПКО (необязательный) – Строка . Имя ПКО, по которому было конвертировано
значение свойства. Атрибут следует задавать только в том случае, если для идентификации значения свойства используется алгоритм поиска. Алгоритм поиска задается в обработчике события ПКО «Поля поиска». НеЗамещать (необязательный) – Булево . Истина – значение свойства не будет
изменено у существующего объекта в базе-приемнике, если при загрузке объект будет найден. Соответствует значению параметра ПКС "Не замещать значение свойства у существующих объектов в приемнике". ПоискПоДатеНаРавенство (необязательный) – Булево . Признак поиска документов на
строгое равенство дате. Если атрибут не задан, то поиск документов будет выполняется в пределах заданной периодичности номера документа. Используется только, если атрибут Имя равен значению Дата . Соответствует значению параметра ПКС "Поиск по дате на равенство".
Атрибуты для служебного свойства {УникальныйИдентификатор} :
ТипИсточника (обязательный) – Строка . Строковое представление типа объекта в базе-источнике. ТипПриемника (обязательный) – Строка . Строковое представление типа объекта в
базе-приемнике.
Формат:
<Свойство>
[<Значение>…</Значение> ](#значение)
<Ссылка>…</Ссылка>
<Нпп>…</Нпп>
<Выражение>…</Выражение>
<Пусто></Пусто>
</Свойство>
 
<Свойство Имя="ВидОперации" Тип="ПеречислениеСсылка.ВидыОперацийПоступлениеТоваровУслуг"> <Значение>ПокупкаКомиссия</Значение> </Свойство>
Значение
Узел Значение (необязательный). Использование: однократно.
Описание:
Содержит значение свойства в строковом представлении.
Атрибуты:
Свойство (необязательный) – Строка . Имя свойства, по которому выполняется поиск объекта по переданному в узле значению.
Формат:
<Значение>СтрокаXML[</Значение>](#значение)
СтрокаXML – Строка , содержащая строковое представление значения.
Пример:
<Значение>НДС18</Значение>
Нпп
Узел Нпп (необязательный). Использование: однократно.
Описание:
Содержит номер ранее выгруженного объекта в файле сообщения по порядку выгрузки.
Используется для оптимизации процесса загрузки данных. Эффективно использовать, если объект неоднократно выгружается в сообщение обмена. В этом случае информация по объекту выгружается в файл только один раз. При последующих обращениях к объекту используется его порядковый номер в сообщении обмена.
Пример:
Представлен фрагмент сообщения обмена с двумя объектами. Первый объект – это группа справочника номенклатуры «Материалы и комплектующие». Порядковый номер элемента в сообщении обмена – 1. Второй объект – это элемент справочника номенклатуры "Компрессор", который находится в папке «Материалы и комплектующие». Порядковый номер элемента в сообщении обмена – 2. В качестве свойства Родитель
второго объекта используется узел Нпп для ссылки на ранее выгруженный объект с
сообщение обмена только один раз.
<Объект Нпп="1" Тип="СправочникСсылка.Номенклатура" ИмяПравила="Номенклатура"> <Ссылка Нпп="1"> <Свойство Имя="{УникальныйИдентификатор}"> <Значение>213d87ae-33d5-11de-b58f-00055d80a2b9</Значение> </Свойство> <Свойство Имя="Наименование"> <Значение>Материалы и комплектующие</Значение> </Свойство> <Свойство Имя="Родитель"/> <Свойство Имя="ЭтоГруппа"> <Значение>true</Значение> </Свойство> </Ссылка> <Свойство Имя="ПометкаУдаления"> <Значение>false</Значение> </Свойство> </Объект> <Объект Нпп="2" Тип="СправочникСсылка.Номенклатура" ИмяПравила="Номенклатура"> <Ссылка Нпп="2"> <Свойство Имя="{УникальныйИдентификатор}"> <Значение>213d87ae-44d5-11de-b58f-00055d81a2b0</Значение> </Свойство> <Свойство Имя="Наименование"> <Значение>Компрессор</Значение> </Свойство> <Свойство Имя="Родитель"> <Нпп>1</Нпп> </Свойство> <Свойство Имя="ЭтоГруппа"> <Значение>false</Значение> </Свойство> </Ссылка> <Свойство Имя="ПометкаУдаления"> <Значение>false</Значение> </Свойство> </Объект>
Атрибуты:
нет
Формат:
<Нпп>СтрокаXML[</Нпп>](#нпп)
СтрокаXML – Строка , содержащая строковое представление значения (числа).
<Нпп>122</Нпп>
Выражение
Узел Выражение (необязательный). Использование: однократно.
Описание:
Содержит выражение, которое требуется вычислить, для получения значения свойства. Значение вычисляется с использованием платформенного метода Вычислить() .
Атрибуты:
нет
Формат:
<Выражение>СтрокаXML[</Выражение>](#выражение)
СтрокаXML – Строка , содержащая строковое представление значения.
Пусто
Узел Пусто (необязательный). Использование: однократно.
Описание:
Используется для указания того, что значение свойства объекта принимает пустое значение заданного типа.
Атрибуты:
нет
Формат:
<Пусто></Пусто>
Пример:
<Пусто></>
ЗначениеПараметра (Для объекта)
Узел ЗначениеПараметра (необязательный). Использование: многократно.
Описание:
Содержит значение произвольного параметра для объекта загрузки. В параметре объекта могут быть переданы такие же значения, как в узле Свойство.
переменной ПараметрыОбъекта (подробнее см. описание обработчика "После загрузки" правила конвертации объектов в конфигурации «Конвертация данных»).
Параметры объекта используются для передачи произвольных вспомогательных данных.
Узел формируется на основании правил описанных в ПКС.
Атрибуты:
Имя (обязательный) – Строка . Имя свойства объекта в базе-получателе, как оно задано в конфигураторе. Тип (обязательный) – Строка . Строковое представление типа свойства.
Формат:
<ЗначениеПараметра>
<Значение>…</Значение>
<Ссылка>…</Ссылка>
[<Нпп>…</Нпп> ](#нпп)
<Выражение>…</Выражение>
<Пусто></Пусто>
</ЗначениеПараметра>
Пример:
<ЗначениеПараметра Имя="НаименованиеПолное" Тип="Строка"> <Значение>Сигары кубинские, 20 шт.</Значение> </ЗначениеПараметра>
ТабличнаяЧасть
Узел ТабличнаяЧасть (необязательный). Использование: многократно.
Описание:
Содержит данные табличной части объекта загрузки. Узел формируется на основании правил описанных в ПКГС.
Атрибуты:
Имя (обязательный) – Строка . Имя табличной части объекта в базе-приемнике, как оно задано в конфигураторе. НеЗамещать (необязательный) – Булево . Истина – табличная часть не будет
замещена у существующего объекта в базе-приемнике, если при загрузке объект
свойства у существующих объектов ИБ".
Формат:
<ТабличнаяЧасть>
<Запись>…</Запись>
</ТабличнаяЧасть>
Пример:
<ТабличнаяЧасть Имя="Товары"> <Запись> <Свойство Имя="Цена" Тип="Число"> <Значение>26</Значение> </Свойство> <Свойство Имя="Сумма" Тип="Число"> <Значение>10400</Значение> </Свойство> <Свойство Имя="СтавкаНДС" Тип="ПеречислениеСсылка.СтавкиНДС"> <Значение>НДС18</Значение> </Свойство> <Свойство Имя="СуммаНДС" Тип="Число"> <Значение>1586.44</Значение> </Свойство> </Запись> <Запись> <Свойство Имя="Цена" Тип="Число"> <Значение>35</Значение> </Свойство> <Свойство Имя="Сумма" Тип="Число"> <Значение>350</Значение> </Свойство> <Свойство Имя="СтавкаНДС" Тип="ПеречислениеСсылка.СтавкиНДС"> <Значение>БезНДС</Значение> </Свойство> <Свойство Имя="СуммаНДС" Тип="Число"> <Значение>0</Значение> </Свойство> </Запись> </ТабличнаяЧасть>
Запись
Узел Запись (необязательный). Использование: многократно.
Описание:
Содержит данные одной строки табличной части или записи движения документа. Узел формируется на основании правил описанных в ПКС.
нет
Формат:
<Запись>
<Свойство>…</Свойство>
<ЗначениеПараметра>…</ЗначениеПараметра>
<СубконтоДт>…</СубконтоДт>
<СубконтоКт>…</СубконтоКт>
</Запись>
Примечание Дочерние узлы СубконтоДт и СубконтоКт используются только для передачи значений субконто движений документов.
Пример:
<Запись> <Свойство Имя="Цена" Тип="Число"> <Значение>26</Значение> </Свойство> <Свойство Имя="Сумма" Тип="Число"> <Значение>10400</Значение> </Свойство> <Свойство Имя="СтавкаНДС" Тип="ПеречислениеСсылка.СтавкиНДС"> <Значение>НДС18</Значение> </Свойство> <Свойство Имя="СуммаНДС" Тип="Число"> <Значение>1586.44</Значение> </Свойство> </Запись>
СубконтоДт
Узел СубконтоДт (необязательный). Использование: многократно.
Описание:
Содержит значение субконто Дт записи набора движений документа. Узел состоит из двух дочерних свойств субконто, одно из которых содержит значение ключа записи, а второе содержит значение субконто. Узел формируется на основании правил описанных в ПКС.
Атрибуты:
нет
<Свойство>…</Свойство>
<Свойство>…</Свойство>
</СубконтоДт>
СубконтоКт
Узел СубконтоКт (необязательный). Использование: многократно.
Описание:
Содержит значение субконто Кт записи набора движений документа. Узел состоит из двух дочерних свойств субконто, одно из которых содержит значение ключа записи, а второе содержит значение субконто. Узел формируется на основании правил описанных в ПКС.
Атрибуты:
нет
Формат:
<СубконтоКт>
<Свойство>…</Свойство>
<Свойство>…</Свойство>
</СубконтоКт>
НаборЗаписей
Узел НаборЗаписей (необязательный). Использование: многократно.
Описание:
Содержит данные движений документа. Узел формируется на основании правил описанных в ПКГС.
Атрибуты:
Имя (обязательный) – Строка . Имя таблицы движений объекта в базе-приемнике, как оно задано в конфигураторе. НеЗамещать (необязательный) – Булево . Истина – движения объекта не будут
замещены, если при загрузке объект будет найден. Соответствует значению параметра ПКГС "Не замещать значение свойства у существующих объектов ИБ". НеОчищать (необязательный) – Булево . Истина – существующие записи набора
движений объекта не будут очищены при загрузке. Соответствует значению параметра НеОчищать обработчика события ПКГС "Перед обработкой".
<Запись>…</Запись>
</НаборЗаписей>
НаборЗаписейРегистра
Узел НаборЗаписейРегистра (необязательный). Использование: многократно.
Описание:
Содержит один объект загрузки. В качестве объекта загрузки выступает набор записей регистра сведений. Узел содержит дочерние узлы, в которых содержатся значения отбора и строки набора записей регистра сведений.
Узел формируется на основании правил описанных в ПКО.
Атрибуты:
Тип (обязательный) – Строка . Строковое представление типа объекта. Используется для получения типа объекта функцией Тип() . ИмяПравила (обязательный) – Строка . Имя правила конвертации объекта. Нпп (необязательный) – Число . Номер выгружаемого объекта в файле в порядке
выгрузки. Используется при отладке процесса обмена и для кэширования выгружаемых данных. Пример использования атрибута для кэширования выгружаемых данных приведен в разделе описания узла Нпп. ПриоритетОбъектаОбмена (необязательный) – Строка . Приоритет объекта загрузки в
случае возникновения коллизии изменений. Возможные значения: "Выше", "Ниже", "Совпадает". Значение по умолчанию – "Выше". Соответствует значению параметра ПКО "Приоритет объекта загрузки". ПустойНабор (необязательный) – Булево . Признак того, что загружаемый объект
содержит пустой набор записей регистра. Истина – не происходит создание новых объектов из значений отбора регистра.
Формат:
<НаборЗаписейРегистра>
<Отбор>…</Отбор>
<СтрокиНабораЗаписей>…</СтрокиНабораЗаписей>
</НаборЗаписейРегистра>
Пример:
 
<НаборЗаписейРегистра Нпп="34" Тип="РегистрСведенийНаборЗаписей.КурсыВалют" ИмяПравила="К <Отбор> <Свойство Имя="Валюта" Тип="СправочникСсылка.Валюты"> <Ссылка> <Свойство Имя="Код" Тип="Строка"> <Значение>036</Значение> </Свойство> </Ссылка> </Свойство> </Отбор> <СтрокиНабораЗаписей> <Объект> <Свойство Имя="Валюта" Тип="СправочникСсылка.Валюты"> <Ссылка> <Свойство Имя="Код" Тип="Строка"> <Значение>036</Значение> </Свойство> </Ссылка> </Свойство> <Свойство Имя="Кратность" Тип="Число"> <Значение>1</Значение> </Свойство> <Свойство Имя="Курс" Тип="Число"> <Значение>1</Значение> </Свойство> </Объект> </СтрокиНабораЗаписей> </НаборЗаписейРегистра>
Отбор
Узел Отбор (необязательный). Использование: однократно.
Описание:
Содержит значения свойств отбора набора записей регистра сведений.
Атрибуты:
нет
Формат:
<Отбор>
<Свойство>…</Свойство>
<ЗначениеПараметра>…</ЗначениеПараметра>
</Отбор>
Пример:
<Отбор> <Свойство Имя="Валюта" Тип="СправочникСсылка.Валюты"> <Ссылка> <Свойство Имя="Код" Тип="Строка"> <Значение>036</Значение> </Свойство> </Ссылка> </Свойство> </Отбор>
СтрокиНабораЗаписей
Узел СтрокиНабораЗаписей (необязательный). Использование: однократно.
Описание:
Содержит строки набора записей регистра сведений. Строки набора представлены дочерними узлами Объект. Дочерние узлы Объект могут содержать только узлы Свойство и ЗначениеПараметра.
Атрибуты:
нет
Формат:
<СтрокиНабораЗаписей>
<Объект>…</Объект>
</СтрокиНабораЗаписей>
Пример:
<СтрокиНабораЗаписей> <Объект> <Свойство Имя="Валюта" Тип="СправочникСсылка.Валюты"> <Ссылка> <Свойство Имя="Код" Тип="Строка"> <Значение>036</Значение> </Свойство> </Ссылка> </Свойство> <Свойство Имя="Кратность" Тип="Число"> <Значение>1</Значение> </Свойство> <Свойство Имя="Курс" Тип="Число"> <Значение>1</Значение> </Свойство> </Объект> </СтрокиНабораЗаписей>
 
УдалениеОбъекта
Узел УдалениеОбъекта (необязательный). Использование: многократно.
Описание:
Содержит информацию об удаленном объекте ссылочного типа в базе-источнике. Используется, когда требуется выполнить удаление объекта ссылочного типа в базе-приемнике при различных сценариях обмена. Например, при выгрузке данных средствами подсистемы «Обмен данными» объект может считаться удаленным, если он был зарегистрирован к выгрузке, однако не прошел фильтр ограничения миграции данных.
При удалении объекта его идентификация (поиск) выполняется по уникальному идентификатору ссылки. При загрузке уникальный идентификатор источника будет заменен на уникальный идентификатор приемника через информацию сопоставления объектов (при необходимости).
Атрибуты:
УникальныйИдентификатор (обязательный) – Строка . Строковое представление уникального идентификатора ссылки удаленного объекта в базе-источнике. При загрузке уникальный идентификатор источника будет заменен на уникальный идентификатор приемника через информацию сопоставления объектов (при необходимости). ТипПриемника (обязательный) – Строка . Строковое представление типа объекта в
базе-приемнике. ТипИсточника (необязательный) – Строка . Строковое представление типа объекта в
базе-источнике.
Формат:
не содержит дочерних узлов.
Пример:
<УдалениеОбъекта ТипПриемника="ДокументСсылка.АвансовыйОтчет" ТипИсточника="ДокументСсылк
ИнформацияОРегистрацииОбъекта
Узел ИнформацияОРегистрацииОбъекта (необязательный). Использование: многократно.
Описание:
Содержит информацию о сопоставлении одного объекта базы-источника одному объекту базы-приемника.
Информация сопоставления объектов используется при загрузке ссылочных объектов. При загрузке объектов выполняется поиск на возможность замены ссылки объекта базы-
 
объектов при загрузке.
Информация сопоставления выгружается в сообщение обмена автоматически при наличии изменений в информации сопоставления.
Узлы располагаются в начале сообщения, в разделе данных сопоставления и до основных данных сообщения обмена.
Атрибуты:
УникальныйИдентификаторИсточника (обязательный) – Строка . Строковое представление уникального идентификатора ссылки объекта в базе-источнике. УникальныйИдентификаторПриемника (обязательный) – Строка . Строковое
представление уникального идентификатора ссылки объекта в базе-приемнике. ТипПриемника (обязательный) – Строка . Строковое представление типа объекта в
базе-приемнике. ТипИсточника (необязательный) – Строка . Строковое представление типа объекта в
базе-источнике. ПустойНабор (необязательный) – Булево . Признак пустого набора записей регистра
сопоставления. Истина – текущая информация о сопоставлении объекта будет удалена при загрузке.
Формат:
не содержит дочерних узлов.
Пример:
<ИнформацияОРегистрацииОбъекта УникальныйИдентификаторИсточника="49278eee-7ef4-11df-866e-
КорректировкаИнформацииОРегистрацииОбъекта
Узел КорректировкаИнформацииОРегистрацииОбъекта (необязательный). Использование: многократно.
Описание:
Содержит данные для корректировки информации сопоставления объектов.
Корректировка информации сопоставления используется для приведения информации сопоставления объектов в правильное состояние после сбоя сопоставления или порчи исходной информации сопоставления.
При загрузке корректировка информации сопоставления используется следующим образом:
если в безе-приемнике нет объекта, для которого загружается информация сопоставления, то корректировка игнорируется,
 
игнорируется.
Узлы располагаются в начале сообщения, в разделе данных сопоставления и до основных данных сообщения обмена, но после узлов о информации регистрации объектов.
Атрибуты:
УникальныйИдентификатор (обязательный) – Строка . Строковое представление уникального идентификатора ссылки объекта в базе-источнике. ТипИсточника (обязательный) – Строка . Строковое представление типа объекта в
базе-источнике. ТипПриемника (обязательный) – Строка . Строковое представление типа объекта в
базе-приемнике.
Формат:
не содержит дочерних узлов.
Пример:
<КорректировкаИнформацииОРегистрацииОбъекта УникальныйИдентификатор="49278eee-7ef4-11df-8
ЗначениеПараметра
Узел ЗначениеПараметра (необязательный). Использование: многократно.
Описание:
Содержит дочерний узел со значением параметра. Полученное из файла значение параметра добавляется в структуру Параметры .
Примечание После загрузки значения параметра из файла выполняется обработчик параметра После загрузки (если определен).
Атрибуты:
Имя (обязательный) – Строка . Имя параметра, для которого предназначено значение. Используется для идентификации значения параметра с правилом параметра (см. атрибут Код для узла Параметр). Имя должно соответствовать требованиям, предъявляемым к ключу платформенного объекта Структура . Тип (обязательный) – Строка . Строковое представление типа значения параметра.
Используется для получения типа платформенной функцией Тип() .
Формат:
<ЗначениеПараметра>
<Значение>… </Значение>
 
<Пусто></Пусто>
</ЗначениеПараметра>
Пример:
<ЗначениеПараметра Имя="НоменклатураПоУмолчанию" Тип="СправочникСсылка.Номенклатура"> <Ссылка> <Свойство Имя="{УникальныйИдентификатор}" Тип="Строка" ТипИсточника="СправочникСс <Значение>0e33e509-512e-11df-abe6-001eec035cea</Значение> </Свойство> <Свойство Имя="ЭтоГруппа" Тип="Булево"> <Значение>false</Значение> </Свойство> </Ссылка> </ЗначениеПараметра>
АлгоритмПослеЗагрузкиПараметров
Узел АлгоритмПослеЗагрузкиПараметров (необязательный). Использование: однократно.
Описание:
Содержит текст обработчика события конвертации "После загрузки параметров".
Атрибуты:
нет
Формат:
<АлгоритмПослеЗагрузкиПараметров>СтрокаXML[</АлгоритмПослеЗагрузкиПараметров>] (#алгоритмпослезагрузкипараметров)
ПравилаОбмена
Узел ПравилаОбмена (обязательный). Использование: однократно.
Описание:
Содержит правила обмена для загрузки данных сообщения обмена – глобальные обработчики событий, параметры, алгоритмы, запросы, правила конвертации объектов и др. Подробнее о правилах обмена см. встроенную справку в конфигурации «Конвертация данных», меню Справка – Быстрое освоение.
Атрибуты:
нет
данными. <Ид> (необязательный) – УникальныйИдентификатор . Уникальный идентификатор
правил конвертации в конфигурации «Конвертация данных». <Наименование> (необязательный) – Строка . Наименование правил обмена в
конфигурации «Конвертация данных». <ДатаВремяСоздания> (необязательный) – Дата . Дата создания файла правил обмена. <Источник> (необязательный) – Строка . Наименование конфигурации-источника.
Содержит номер версии конфигурации-источника. <Приемник> (необязательный) – Строка . Наименование конфигурации-приемника.
Содержит номер версии конфигурации-приемника. <ПередЗагрузкойОбъекта> (необязательный) – Строка . Текст обработчика события
конвертации "Перед загрузкой объекта". <ПослеЗагрузкиОбъекта> (необязательный) – Строка . Текст обработчика события
конвертации "После загрузки объекта". <ПередЗагрузкойДанных> (необязательный) – Строка . Текст обработчика события
конвертации "Перед загрузкой данных". <ПослеЗагрузкиДанных> (необязательный) – Строка . Текст обработчика события
конвертации "После загрузки данных". <ПриПолученииИнформацииОбУдалении> (необязательный) – Строка . Текст обработчика
события конвертации "При получении удаления". <ПослеПолученияИнформацииОбУзлахОбмена> (необязательный) – Строка . Текст
обработчика события конвертации "После получения узлов обмена".
Формат:
<ПравилаОбмена>
<ВерсияФормата>СтрокаXML</ВерсияФормата>
<Ид>СтрокаXML</Ид>
<Наименование>СтрокаXML</Наименование>
<ДатаВремяСоздания>СтрокаXML</ДатаВремяСоздания>
<Источник>СтрокаXML</Источник>
<Приемник>СтрокаXML</Приемник>
<ПередЗагрузкойОбъекта>СтрокаXML</ПередЗагрузкойОбъекта>
<ПослеЗагрузкиОбъекта>СтрокаXML</ПослеЗагрузкиОбъекта>
<ПередЗагрузкойДанных>СтрокаXML</ПередЗагрузкойДанных>
<ПослеЗагрузкиДанных>СтрокаXML</ПослеЗагрузкиДанных>
<ПриПолученииИнформацииОбУдалении>СтрокаXML</ ПриПолученииИнформацииОбУдалении>
ПослеПолученияИнформацииОбУзлахОбмена>
<ПравилаКонвертацииОбъектов>…</ПравилаКонвертацииОбъектов>
<Параметры>…</Параметры>
<Алгоритмы>…</Алгоритмы>
<Запросы>…</Запросы>
</ПравилаОбмена>
Пример:
(только заголовок правил обмена) <ПравилаОбмена> <ВерсияФормата>2.01</ВерсияФормата> <Ид>24451442-943d-4182-bc1b-42e04d1fdf33</Ид> <Наименование>УправлениеТорговлей-БухгалтерияПредприятия</Наименование> <ДатаВремяСоздания>2010-07-22T19:17:04</ДатаВремяСоздания> <Источник>УправлениеТорговлей</Источник> <Приемник>БухгалтерияПредприятия</Приемник> ... </ПравилаОбмена>
ПравилаКонвертацииОбъектов
Узел ПравилаКонвертацииОбъектов (необязательный). Использование: однократно.
Описание:
Содержит дочерние узлы правил конвертации объектов.
Атрибуты:
нет
<ПравилаКонвертацииОбъектов>
<Правило>…</Правило>
</ПравилаКонвертацииОбъектов>
Правило
Узел Правило (необязательный). Использование: многократно.
Описание:
Содержит описание одного правила конвертации объекта базы-источника в объект базы-приемника. Правило содержит вспомогательную информацию, которая используется при
нет
Узлы:
<Код> (обязательный) – Строка . Имя правила конвертации. Имя правила должно быть уникальным в пространстве имен правил конвертации в текущем сообщении обмена. Используется для идентификации загружаемого объекта с правилом конвертации (см. атрибут ИмяПравила для узла Объект). <Источник> (обязательный) – Строка . Строковое представление типа объекта базы-
источника. <Приемник> (обязательный) – Строка . Строковое представление типа объекта базы-
приемника. <СинхронизироватьПоИдентификатору> (необязательный) – Булево . Истина –
идентификация (поиск) объекта при загрузке будет выполняться по уникальному идентификатору ссылки. Также будет задействован механизм сопоставления объектов для подмены ссылки объекта базы-источника на ссылку объекта базы-приемника (при необходимости). Ложь – идентификация объекта при загрузке будет выполняться по свойствам, указанным в узле Ссылка (свойствам поиска). <ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли> (необязательный) – Булево . Истина – идентификация (поиск) объекта при загрузке будет выполняться по
свойствам, указанным в узле Ссылка, при условии, что объект не будет идентифицирован по уникальному идентификатору ссылки. Используется только если, узел <СинхронизироватьПоИдентификатору> содержит значение Истина . <ГенерироватьНовыйНомерИлиКодЕслиНеУказан> (необязательный) – Булево . Истина –
будет назначен код или номер объекту перед записью в базу-приемник, если код или номер не были назначены объекту в процессе загрузки. <ПередЗагрузкой> (необязательный) – Строка . Текст обработчика события правил
конвертации объектов Перед загрузкой . <ПриЗагрузке> (необязательный) – Строка . Текст обработчика события правил
конвертации объектов При загрузке . <ПослеЗагрузки> (необязательный) – Строка . Текст обработчика события правил
конвертации объектов После загрузки .
Узлы для поддержки интерактивной загрузки:
<ПоляТаблицы> (обязательный) – Строка . Список всех реквизитов шапки объекта, которые участвуют в обмене, разделенные символом запятой. <ПоляПоиска> (обязательный) – Строка . Список реквизитов шапки объекта, которые
используются как поля поиска, разделенные символом запятой.
Формат:
<Правило>
<Код>СтрокаXML</Код>(Строка)
<Источник >СтрокаXML</Источник>
 
<СинхронизироватьПоИдентификатору>СтрокаXML</ СинхронизироватьПоИдентификатору>
<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>СтрокаXML</ ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>СтрокаXML</ ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
<ПередЗагрузкой>СтрокаXML</ПередЗагрузкой>
<ПриЗагрузке >СтрокаXML</ПриЗагрузке>
<ПослеЗагрузки >СтрокаXML</ПослеЗагрузки>
<ПоляТаблицы >СтрокаXML</ПоляТаблицы>
<ПоляПоиска >СтрокаXML</ПоляПоиска>
</Правило>
Пример:
<Правило> <Код>Организации</Код> <СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификаторy> <ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУка <Источник>СправочникСсылка.Организации</Источник> <Приемник>СправочникСсылка.Организации</Приемник> <ПоляТаблицы>ИНН,КПП,НаименованиеСокращенное,Наименование,ЮрФизЛицо,КодПоОКАТО,КодПоО <ПоляПоиска>ИНН,КПП,НаименованиеСокращенное</ПоляПоиска> </Правило>
Параметры
Узел Параметры (необязательный). Использование: однократно.
Описание:
Содержит дочерние узлы параметров загрузки.
Атрибуты:
нет
Формат:
<Параметры>
<Параметр></Параметр>
Параметр
Узел Параметр (необязательный). Использование: многократно.
Описание:
Содержит описание параметра, который используется при загрузке данных. Параметр добавляется в структуру Параметры . Эта структура используется для получения значений параметров и доступна из любого обработчика события загрузки данных.
Добавляется только ключ структуры. Значение параметра не передается. Для передачи значений параметров используется узел ЗначениеПараметра .
Примечание Подробнее о структуре Параметры см. встроенную справку в конфигурации «Конвертация данных», меню Справка – Информация об обработчиках.
Атрибуты:
Имя (обязательный) – Строка . Имя параметра. Имя должно соответствовать требованиям, предъявляемым к ключу платформенного объекта Структура . Наименование (необязательный) – Строка . Пользовательское описание параметра. ПослеЗагрузкиПараметра (необязательный) – Строка . Текст обработчика параметра После загрузки .
Формат:
<Параметр></Параметр>
Алгоритмы
Узел Алгоритмы (необязательный). Использование: однократно.
Описание:
Содержит дочерние узлы алгоритмов для загрузки данных.
Атрибуты:
нет
Формат:
<Алгоритмы>
<Алгоритм>…</Алгоритм>
</Алгоритмы>
Пример:
<Алгоритмы> <Алгоритм ИспользуетсяПриЗагрузке="true" Имя="ЗаполнитьСтатьюДоходов"> <Текст>Значение = Параметры.СтатьяДоходовПоУмолчанию;</Текст> </Алгоритм> </Алгоритмы>
Алгоритм
Узел Алгоритм (необязательный). Использование: многократно.
Описание:
Содержит текст алгоритма, который используется при загрузке данных. Параметр добавляется в структуру Алгоритмы . Эта структура используется для получения кода алгоритмов и доступна из любого обработчика события загрузки данных.
Примечание Подробнее об использовании алгоритмов см. встроенную справку в конфигурации «Конвертация данных».
Атрибуты:
Имя (обязательный) – Строка . Имя алгоритма. Имя должно соответствовать требованиям, предъявляемым к ключу платформенного объекта Структура . ИспользуетсяПриЗагрузке (обязательный) – Булево . Атрибут должен всегда принимать
значение Истина .
Формат:
<Алгоритм>
<Текст>СтрокаXML[</Текст>](#текст)
</Алгоритм>
Запросы
Узел Запросы (необязательный). Использование: однократно.
Описание:
Содержит дочерние узлы запросов для обработчиков загрузки данных.
Атрибуты:
нет
Формат:
<Запросы>
<Запрос>…</Запрос>
Запрос
Узел Запрос (необязательный). Использование: многократно.
Описание:
Содержит текст запроса, который используется в обработчиках при загрузке данных. Параметр добавляется в структуру Запросы . Эта структура используется для получения запросов и доступна из любого обработчика события загрузки данных.
Примечание Подробнее об использовании запросов см. встроенную справку в конфигурации «Конвертация данных».
Атрибуты:
Имя (обязательный) – Строка . Имя запроса. Имя должно соответствовать требованиям, предъявляемым к ключу платформенного объекта Структура . ИспользуетсяПриЗагрузке (обязательный) – Булево . Атрибут должен всегда принимать
значение Истина .
Формат:
<Запрос>
<Текст>СтрокаXML</Текст>
</Запрос>
Текст
Узел Текст (обязательный). Использование: однократно.
Описание:
Содержит текст запроса или текст алгоритма.
Атрибуты:
нет.
Формат:
<Текст>СтрокаXML</Текст>
Пример:
<Текст>Значение = Параметры.СтатьяДоходовПоУмолчанию;</Текст>