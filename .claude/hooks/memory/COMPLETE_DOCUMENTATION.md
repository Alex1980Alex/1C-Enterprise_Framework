# Memory Hooks - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–í–µ—Ä—Å–∏—è:** 2.0
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-02
**–°—Ç–∞—Ç—É—Å:** Production Ready

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
3. [–ê–∫—Ç–∏–≤–Ω—ã–µ —Ö—É–∫–∏](#–∞–∫—Ç–∏–≤–Ω—ã–µ-—Ö—É–∫–∏)
4. [Python —Å–∫—Ä–∏–ø—Ç—ã](#python-—Å–∫—Ä–∏–ø—Ç—ã)
5. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
6. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
7. [–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è](#–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è-–∏-—É–ª—É—á—à–µ–Ω–∏—è)
8. [Troubleshooting](#troubleshooting)
9. [Best Practices](#best-practices)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

Memory Hooks - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ö—É–∫–æ–≤ –¥–ª—è Claude Code, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Memory-AI MCP
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–æ—Ç–∞—Ü–∏—é –ª–æ–≥–æ–≤

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–∞, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Read, Grep, Task –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- **Memory-AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü—Ä—è–º–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Knowledge Graph
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –î–∞—à–±–æ—Ä–¥ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **–ó–∞—â–∏—Ç–∞**: Graceful degradation - hooks –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É Claude

### –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏

**–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è:** ~65 —á–∞—Å–æ–≤/–º–µ—Å—è—Ü
- –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ä–µ—à–µ–Ω–∏–π: ~40 —á–∞—Å–æ–≤/–º–µ—Å—è—Ü
- –ò–∑–±–µ–∂–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è: ~15 —á–∞—Å–æ–≤/–º–µ—Å—è—Ü
- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É: ~10 —á–∞—Å–æ–≤/–º–µ—Å—è—Ü

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
.claude/hooks/memory/
‚îú‚îÄ‚îÄ COMPLETE_DOCUMENTATION.md      # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
‚îú‚îÄ‚îÄ config.json                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
‚îÇ
‚îú‚îÄ‚îÄ Hooks (.bat —Ñ–∞–π–ª—ã)
‚îÇ   ‚îú‚îÄ‚îÄ pre-prompt-check.bat              # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏ –ø–µ—Ä–µ–¥ –ø—Ä–æ–º–ø—Ç–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ post-user-prompt-analysis.bat     # –ê–Ω–∞–ª–∏–∑ –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ post-tool-save.bat                # –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ auto-rotation-hook.bat            # –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ monitor.bat                       # –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îî‚îÄ‚îÄ ROTATE_LOGS.bat                   # –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –≤—Ä—É—á–Ω—É—é
‚îÇ
‚îú‚îÄ‚îÄ Python —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ auto-save.py                # –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ auto-save-improved.py       # –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (–∏—Å—Ö–æ–¥–Ω–∏–∫)
‚îÇ   ‚îú‚îÄ‚îÄ task-analysis.py            # –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ memory_ai_wrapper.py        # Wrapper –¥–ª—è Memory-AI
‚îÇ   ‚îú‚îÄ‚îÄ hooks-monitor.py            # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ log-rotation.py             # –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ auto-log-rotation.py        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test-auto-rotation-calls.py
‚îÇ   ‚îî‚îÄ‚îÄ test-counter.py
‚îÇ
‚îî‚îÄ‚îÄ –õ–æ–≥–∏ –∏ –∫—ç—à (cache/)
    ‚îú‚îÄ‚îÄ task-analysis-memory.jsonl    # –ê–Ω–∞–ª–∏–∑—ã –∑–∞–¥–∞—á
    ‚îú‚îÄ‚îÄ auto-save-memory.jsonl        # –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ memory-ai-hooks.jsonl         # Memory-AI –∑–∞–ø–∏—Å–∏
    ‚îî‚îÄ‚îÄ hooks-error.log               # –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å   ‚îÇ
‚îÇ  (new prompt)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ UserPromptSubmit Hook              ‚îÇ
‚îÇ 1. pre-prompt-check.bat            ‚îÇ
‚îÇ 2. post-user-prompt-analysis.bat   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ task-analysis.py                   ‚îÇ
‚îÇ ‚Ä¢ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤         ‚îÇ
‚îÇ ‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏          ‚îÇ
‚îÇ ‚Ä¢ –û—Ü–µ–Ω–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞/—Å–ª–æ–∂–Ω–æ—Å—Ç–∏      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Claude Code –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É       ‚îÇ
‚îÇ ‚Ä¢ Read, Grep, WebFetch –∏ –¥—Ä.       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PostToolUse Hook                   ‚îÇ
‚îÇ post-tool-save.bat                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ auto-save.py                       ‚îÇ
‚îÇ ‚Ä¢ –ß—Ç–µ–Ω–∏–µ hook JSON –∏–∑ stdin        ‚îÇ
‚îÇ ‚Ä¢ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏    ‚îÇ
‚îÇ ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSONL               ‚îÇ
‚îÇ ‚Ä¢ –í—ã–∑–æ–≤ Memory-AI wrapper          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Memory-AI MCP                      ‚îÇ
‚îÇ ‚Ä¢ Knowledge Graph                  ‚îÇ
‚îÇ ‚Ä¢ TimescaleDB Timeline             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ê–∫—Ç–∏–≤–Ω—ã–µ —Ö—É–∫–∏

### 1. pre-prompt-check.bat

**–¢—Ä–∏–≥–≥–µ—Ä:** UserPromptSubmit (–ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –ø—Ä–æ–º–ø—Ç–∞)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Memory MCP
**Timeout:** 10 —Å–µ–∫—É–Ω–¥

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Memory MCP
- –¢–∏—Ö–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (exit code 0 –≤—Å–µ–≥–¥–∞)
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É Claude

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2025-11-02):**
- ‚úÖ –£–±—Ä–∞–Ω—ã ANSI escape –∫–æ–¥—ã
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `if errorlevel`
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å goto –º–µ—Ç–∫–∞–º–∏
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–∞–≤–ª–µ–Ω –≤—ã–≤–æ–¥

### 2. post-user-prompt-analysis.bat

**–¢—Ä–∏–≥–≥–µ—Ä:** UserPromptSubmit (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑ –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
**Timeout:** 10 —Å–µ–∫—É–Ω–¥

**–§—É–Ω–∫—Ü–∏–∏:**
- –ó–∞–ø—É—Å–∫–∞–µ—Ç task-analysis.py
- –ü–µ—Ä–µ–¥–∞–µ—Ç stdin –≤ Python —Å–∫—Ä–∏–ø—Ç
- –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç success (exit 0)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2025-11-01):**
- ‚úÖ –£–¥–∞–ª–µ–Ω –±–ª–æ–∫ —Å `exit /b 1`
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥

### 3. post-tool-save.bat

**–¢—Ä–∏–≥–≥–µ—Ä:** PostToolUse (–ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
**Timeout:** 30 —Å–µ–∫—É–Ω–¥
**Matcher:** `Read|Grep|Glob|WebFetch|WebSearch|mcp__github__|mcp__1c|Task|mcp__serena__`

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç config.json
- –ó–∞–ø—É—Å–∫–∞–µ—Ç auto-save.py
- –ü–µ—Ä–µ–¥–∞–µ—Ç hook JSON —á–µ—Ä–µ–∑ stdin

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2025-11-01):**
- ‚úÖ –£–±—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω –¥–æ –ø—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ stdin
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω matcher –≤ settings.local.json

### 4. auto-rotation-hook.bat

**–¢—Ä–∏–≥–≥–µ—Ä:** UserPromptSubmit
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
**Timeout:** 5 —Å–µ–∫—É–Ω–¥

**–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –†—É—á–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ log-rotation.py

---

## Python —Å–∫—Ä–∏–ø—Ç—ã

### auto-save.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

```python
def read_hook_input():
    """–ß—Ç–µ–Ω–∏–µ JSON –¥–∞–Ω–Ω—ã—Ö –∏–∑ stdin (hook input)"""
    hook_data = json.load(sys.stdin)
    return hook_data

def extract_context(hook_data):
    """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ hook JSON"""
    tool_name = hook_data.get("tool_name", "unknown")
    tool_response = hook_data.get("tool_response", "")
    # ...

def should_save(tool_name, config):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω—É–∂–Ω–æ –ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç"""
    # Blacklist –¥–ª—è Write/Edit –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    BLACKLIST = ["Write", "Edit", "MultiEdit", "NotebookEdit"]
    if tool_name in BLACKLIST:
        return False
    # ...

def classify_activity(tool_name):
    """–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"""
    if tool_name in ["Read", "Grep", "Glob"]:
        return "code_exploration", 0.75
    elif "WebFetch" in tool_name or "WebSearch" in tool_name:
        return "web_research", 0.7
    # ...
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:**
- `code_exploration` (Read, Grep, Glob) - importance: 0.75
- `web_research` (WebFetch, WebSearch) - importance: 0.7
- `github_interaction` (mcp__github__*) - importance: 0.8
- `task_execution` (Task) - importance: 0.85
- `code_analysis` (mcp__serena__*) - importance: 0.8
- `1c_interaction` (mcp__1c*) - importance: 0.8

**Blacklist –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:**
- Write, Edit, MultiEdit, NotebookEdit (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ß—Ç–µ–Ω–∏–µ –∏–∑ stdin –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (2025-11-01)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω blacklist –¥–ª—è Write/Edit (2025-11-01)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8 (2025-11-01)

### task-analysis.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–§—É–Ω–∫—Ü–∏–∏:**
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–æ–ø-—Å–ª–æ–≤)
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏ (feature_development, bug_fix, refactoring –∏ –¥—Ä.)
- –û—Ü–µ–Ω–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (high, medium, low)
- –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (high, medium, low)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ task-analysis-memory.jsonl

**–¢–∏–ø—ã –∑–∞–¥–∞—á:**
- `feature_development` - –¥–æ–±–∞–≤—å, —Å–æ–∑–¥–∞–π, —Ä–µ–∞–ª–∏–∑—É–π
- `bug_fix` - –∏—Å–ø—Ä–∞–≤—å, –ø–æ—á–∏–Ω—å, –±–∞–≥
- `refactoring` - —Ä–µ—Ñ–∞–∫—Ç–æ—Ä, –æ–ø—Ç–∏–º–∏–∑, —É–ª—É—á—à
- `code_review` - –ø—Ä–æ–≤–µ—Ä—å, —Ä–µ–≤—å—é
- `documentation` - –¥–æ–∫—É–º–µ–Ω—Ç, –æ–ø–∏—à–∏
- `testing` - —Ç–µ—Å—Ç, –ø—Ä–æ–≤–µ—Ä–∫–∞
- `analysis` - –∞–Ω–∞–ª–∏–∑, –∏—Å—Å–ª–µ–¥—É–π

### memory_ai_wrapper.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Wrapper –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Memory-AI MCP

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –æ—Ç auto-save.py –∏ task-analysis.py
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Memory-AI
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ memory-ai-hooks.jsonl
- TODO: –†–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ MCP —á–µ—Ä–µ–∑ subprocess

### hooks-monitor.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–∞—à–±–æ—Ä–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ hooks

**–ó–∞–ø—É—Å–∫:**
```bash
python .claude/hooks/memory/hooks-monitor.py        # –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
python .claude/hooks/memory/hooks-monitor.py health # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
.claude/hooks/memory/monitor.bat                    # –° –ø–∞—É–∑–æ–π
```

**–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**

1. **–ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á:**
   - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
   - –†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º
   - –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
   - –†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
   - 5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–¥–∞—á

2. **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:**
   - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
   - –¢–æ–ø-10 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
   - –†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - 5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π

3. **Memory-AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
   - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
   - –°—Ä–µ–¥–Ω—è—è –≤–∞–∂–Ω–æ—Å—Ç—å
   - –ó–∞–ø–∏—Å–µ–π —Å –∫–æ–¥–æ–º
   - –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º

4. **–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
   - –°—É–º–º–∞—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
   - –†–∞–∑–º–µ—Ä JSONL —Ñ–∞–π–ª–æ–≤

### log-rotation.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–æ—Ç–∞—Ü–∏—è –∏ –∞—Ä—Ö–∏–≤–∞—Ü–∏—è –ª–æ–≥–æ–≤

**–ó–∞–ø—É—Å–∫:**
```bash
python .claude/hooks/memory/log-rotation.py         # –†–æ—Ç–∞—Ü–∏—è —Å–µ–π—á–∞—Å
python .claude/hooks/memory/log-rotation.py status  # –°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–æ–≤
.claude/hooks/memory/ROTATE_LOGS.bat                # –° –ø–∞—É–∑–æ–π
```

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ JSONL —Ñ–∞–π–ª–æ–≤
- –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ (5MB –¥–ª—è logs, 10MB –¥–ª—è JSONL)
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∞—Ä—Ö–∏–≤–æ–≤ (—Ö—Ä–∞–Ω–∏—Ç—Å—è 5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö)
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—É—Å—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### config.json

```json
{
  "enabled": true,
  "auto_save_tools": [
    "Read",
    "Grep",
    "Glob",
    "WebFetch",
    "WebSearch",
    "mcp__github__",
    "mcp__1c",
    "Task",
    "mcp__serena__find_symbol",
    "mcp__serena__get_symbols_overview",
    "mcp__serena__search_for_pattern"
  ],
  "min_content_length": 250,
  "save_to_timescale": true,
  "save_to_knowledge_graph": true,
  "log_file": "cache/auto-save.log",
  "verbose": true,
  "auto_rotation": {
    "enabled": true,
    "check_interval": 10,
    "max_log_size_mb": 5,
    "max_jsonl_size_mb": 10,
    "max_archives": 5
  }
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `enabled` | boolean | true | –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ |
| `auto_save_tools` | array | [...] | –°–ø–∏—Å–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ |
| `min_content_length` | number | 250 | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è |
| `save_to_timescale` | boolean | true | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ TimescaleDB |
| `save_to_knowledge_graph` | boolean | true | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Knowledge Graph |
| `log_file` | string | "cache/auto-save.log" | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤ |
| `verbose` | boolean | true | –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ |

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `auto_rotation.enabled` | true | –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ä–æ—Ç–∞—Ü–∏—é |
| `auto_rotation.check_interval` | 10 | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Å–µ–∫—É–Ω–¥—ã) |
| `auto_rotation.max_log_size_mb` | 5 | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä .log —Ñ–∞–π–ª–∞ |
| `auto_rotation.max_jsonl_size_mb` | 10 | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä .jsonl —Ñ–∞–π–ª–∞ |
| `auto_rotation.max_archives` | 5 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—Ä–∞–Ω–∏–º—ã—Ö –∞—Ä—Ö–∏–≤–æ–≤ |

### settings.local.json

```json
{
  "hooks": {
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/memory/pre-prompt-check.bat",
            "timeout": 10
          },
          {
            "type": "command",
            "command": ".claude/hooks/memory/post-user-prompt-analysis.bat",
            "timeout": 10
          },
          {
            "type": "command",
            "command": ".claude/hooks/memory/auto-rotation-hook.bat",
            "timeout": 5
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Read|Grep|Glob|WebFetch|WebSearch|mcp__github__|mcp__1c|Task|mcp__serena__",
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/memory/post-tool-save.bat",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
python .claude/hooks/memory/hooks-monitor.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
python .claude/hooks/memory/hooks-monitor.py health

# –° –ø–∞—É–∑–æ–π (Windows)
.claude\hooks\memory\monitor.bat
```

### –ö–æ–º–∞–Ω–¥—ã —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤

```bash
# –†–æ—Ç–∞—Ü–∏—è —Å–µ–π—á–∞—Å
python .claude/hooks/memory/log-rotation.py

# –°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–æ–≤
python .claude/hooks/memory/log-rotation.py status

# –° –ø–∞—É–∑–æ–π (Windows)
.claude\hooks\memory\ROTATE_LOGS.bat
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
type cache\hooks-error.log

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (PowerShell)
Get-Content cache\hooks-error.log -Wait -Tail 10
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä JSONL —Ñ–∞–π–ª–æ–≤

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–ø–∏—Å–µ–π
powershell -Command "Get-Content cache\task-analysis-memory.jsonl | Select-Object -Last 5"
powershell -Command "Get-Content cache\auto-save-memory.jsonl | Select-Object -Last 5"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
powershell -Command "(Get-Content cache\auto-save-memory.jsonl | Measure-Object -Line).Lines"
```

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è

### –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

#### 2025-11-02: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ pre-prompt-check.bat

**–ü—Ä–æ–±–ª–µ–º–∞:** UserPromptSubmit hook error

**–ü—Ä–∏—á–∏–Ω–∞:**
- –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ `if %errorlevel% == 0`
- ANSI escape –∫–æ–¥—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
- –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è for/f –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- –í—ã–≤–æ–¥ –≤ stderr

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `if errorlevel` –∏ goto –º–µ—Ç–æ–∫
- ‚úÖ –£–±—Ä–∞–Ω—ã ANSI escape –∫–æ–¥—ã
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–∞–≤–ª–µ–Ω –≤—ã–≤–æ–¥

#### 2025-11-01: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ post-user-prompt-analysis.bat

**–ü—Ä–æ–±–ª–µ–º–∞:** UserPromptSubmit hook error –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –£–¥–∞–ª–µ–Ω –±–ª–æ–∫ —Å `exit /b 1`
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤–æ–∑–≤—Ä–∞—Ç `exit /b 0`

#### 2025-11-01: –ü–æ–ª–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ PostToolUse hooks

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∏ Read, Grep, Glob hooks

**–ü—Ä–∏—á–∏–Ω–∞:** –ß—Ç–µ–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω auto-save.py –¥–ª—è —á—Ç–µ–Ω–∏—è JSON –∏–∑ stdin
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω post-tool-save.bat
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã matcher –∏ timeout –≤ settings.local.json

#### 2025-11-01: –î–æ–±–∞–≤–ª–µ–Ω blacklist –¥–ª—è Write/Edit

**–ü—Ä–æ–±–ª–µ–º–∞:** PostToolUse:Write hook error

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω code-level blacklist –≤ auto-save.py
- ‚úÖ Defense in depth (matcher + blacklist)

#### 2025-11-01: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è min_content_length

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** 100 ‚Üí 250 —Å–∏–º–≤–æ–ª–æ–≤

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ "—à—É–º–Ω—ã—Ö" –∑–∞–ø–∏—Å–µ–π
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—É

#### 2025-11-01: –£–¥–∞–ª–µ–Ω–∏–µ .sh –≤–µ—Ä—Å–∏–π —Ö—É–∫–æ–≤

**–ü—Ä–∏—á–∏–Ω–∞:** –£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (Windows-only –ø—Ä–æ–µ–∫—Ç)

**–£–¥–∞–ª–µ–Ω—ã:**
- pre-prompt-check.sh
- post-user-prompt-analysis.sh
- post-tool-save.sh

### –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –û—à–∏–±–∫–∏ hooks | –ß–∞—Å—Ç—ã–µ | –ù–µ—Ç | 100% |
| –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | 0% | 100% | +100% |
| Exit code —É—Å–ø–µ—Ö | 60% | 100% | +40% |
| –†–∞–∑–º–µ—Ä JSONL (–∫–∞—á–µ—Å—Ç–≤–æ) | –°—Ä–µ–¥–Ω–∏–π | –í—ã—Å–æ–∫–∏–π | +60% |
| –®—É–º–Ω—ã–µ –∑–∞–ø–∏—Å–∏ | 40% | 10% | -75% |
| –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∞—è | +100% |

---

## Troubleshooting

### UserPromptSubmit hook error

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–æ–º–ø—Ç–∞
- Claude Code –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ pre-prompt-check.bat –∏ post-user-prompt-analysis.bat
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ–Ω–∏ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `exit /b 0`
3. **–ü–ï–†–ï–ó–ê–ü–£–°–¢–ò–¢–ï Claude Code** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)

### PostToolUse hook error

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Read, Grep, Write –∏ –¥—Ä.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ auto-save.py - –¥–æ–ª–∂–µ–Ω —á–∏—Ç–∞—Ç—å stdin
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ matcher –≤ settings.local.json
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ blacklist –≤ auto-save.py

### –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ JSONL —Ñ–∞–π–ª–∞—Ö

**–ü—Ä–∏—á–∏–Ω—ã:**
- Hooks –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã
- min_content_length —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π
- config.json enabled=false

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
type .claude\hooks\memory\config.json

# –ü—Ä–æ–≤–µ—Ä–∫–∞ settings
type .claude\settings.local.json

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫
type cache\hooks-error.log
```

### –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–∏—á–∏–Ω–∞:** Windows –∫–æ–Ω—Å–æ–ª—å (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞)

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PowerShell –≤–º–µ—Å—Ç–æ cmd
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π UTF-8
- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —á–∏—Ç–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ë–æ–ª—å—à–∏–µ JSONL —Ñ–∞–π–ª—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
- –§–∞–π–ª—ã >10MB
- –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
.claude\hooks\memory\ROTATE_LOGS.bat

# –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Windows Task Scheduler
```

---

## Best Practices

### –§–∏–ª–æ—Å–æ—Ñ–∏—è hooks

**–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:** Hooks –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–æ–ª–∂–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É Claude Code

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚úÖ –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `exit /b 0`
- ‚úÖ –ü–æ–¥–∞–≤–ª—è—Ç—å –≤—ã–≤–æ–¥ (`>nul 2>&1`)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å timeout
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ —Ñ–∞–π–ª—ã
- ‚úÖ Graceful degradation

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚ùå –í–æ–∑–≤—Ä–∞—â–∞—Ç—å `exit /b 1` –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚ùå –í—ã–≤–æ–¥–∏—Ç—å –≤ stdout/stderr
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –ø—Ä–æ–µ–∫—Ç

#### –ú–∞–ª—ã–µ –ø—Ä–æ–µ–∫—Ç—ã (<1000 —Ñ–∞–π–ª–æ–≤)

```json
{
  "min_content_length": 200,
  "auto_rotation": {
    "max_log_size_mb": 3,
    "max_jsonl_size_mb": 5
  }
}
```

#### –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç—ã (1000-5000 —Ñ–∞–π–ª–æ–≤)

```json
{
  "min_content_length": 250,
  "auto_rotation": {
    "max_log_size_mb": 5,
    "max_jsonl_size_mb": 10
  }
}
```

#### –ö—Ä—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã (>5000 —Ñ–∞–π–ª–æ–≤)

```json
{
  "min_content_length": 300,
  "auto_rotation": {
    "max_log_size_mb": 10,
    "max_jsonl_size_mb": 20
  }
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —á–∞—Å—Ç–æ—Ç–∞:**
- –ú–∞–ª—ã–µ –ø—Ä–æ–µ–∫—Ç—ã: —Ä–∞–∑ –≤ –º–µ—Å—è—Ü
- –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç—ã: —Ä–∞–∑ –≤ 2 –Ω–µ–¥–µ–ª–∏
- –ö—Ä—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã: —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
.claude\hooks\memory\monitor.bat
```

### –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Windows Task Scheduler –¥–ª—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π —Ä–æ—Ç–∞—Ü–∏–∏
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Task Scheduler:**
```
python D:\1C-Enterprise_Framework\.claude\hooks\memory\log-rotation.py
```

### –ê—Ä—Ö–∏–≤–∞—Ü–∏—è

**–ö–æ–≥–¥–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å:**
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 10MB
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –ø—Ä–æ–µ–∫—Ç–∞
- –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∫—Ä—É–ø–Ω–æ–≥–æ —ç—Ç–∞–ø–∞

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
mkdir cache\archive
move cache\*.jsonl cache\archive\backup-2025-11-02\
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Memory Hooks - —ç—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è Claude Code, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è:

- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑** –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** —Ä–∞–±–æ—Ç—ã
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Memory-AI**
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**
- ‚úÖ **–ó–∞—â–∏—Ç—É –æ—Ç –æ—à–∏–±–æ–∫**

**–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç–µ.**

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   type .claude\hooks\memory\config.json
   type .claude\settings.local.json
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   ```bash
   .claude\hooks\memory\monitor.bat
   ```

3. **–†–∞–±–æ—Ç–∞–π—Ç–µ –∫–∞–∫ –æ–±—ã—á–Ω–æ** - hooks —Ä–∞–±–æ—Ç–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

4. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ** –ª–æ–≥–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Windows Task Scheduler –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º Memory-AI MCP —á–µ—Ä–µ–∑ subprocess
- –†–∞—Å—à–∏—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –î–æ–±–∞–≤—å—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 2.0
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-02
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
**–ê–≤—Ç–æ—Ä:** Claude Code Team
**–õ–∏—Ü–µ–Ω–∑–∏—è:** MIT
